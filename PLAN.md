# PLAN.md
## Поэтапный план реализации приложения GoNext - Дневник туриста

---

## Этап 1: Настройка проекта и инфраструктуры

### 1.1 Установка и настройка зависимостей
- [ ] Установить `expo-sqlite` для работы с локальной базой данных
- [ ] Установить `expo-image-picker` для работы с фотографиями
- [ ] Установить `expo-location` для работы с геолокацией
- [ ] Установить `react-native-maps` или `expo-location` для интеграции с картами
- [ ] Настроить TypeScript типы для всех сущностей

### 1.2 Создание структуры базы данных
- [ ] Создать модуль инициализации SQLite базы данных
- [ ] Создать таблицу `places` с полями:
  - `id` (PRIMARY KEY)
  - `name` (TEXT)
  - `description` (TEXT)
  - `visitlater` (BOOLEAN)
  - `liked` (BOOLEAN)
  - `latitude` (REAL)
  - `longitude` (REAL)
  - `createdAt` (DATETIME)
- [ ] Создать таблицу `trips` с полями:
  - `id` (PRIMARY KEY)
  - `title` (TEXT)
  - `description` (TEXT)
  - `startDate` (DATE)
  - `endDate` (DATE)
  - `current` (BOOLEAN)
  - `createdAt` (DATETIME)
- [ ] Создать таблицу `trip_places` с полями:
  - `id` (PRIMARY KEY)
  - `tripId` (INTEGER, FOREIGN KEY)
  - `placeId` (INTEGER, FOREIGN KEY)
  - `order` (INTEGER)
  - `visited` (BOOLEAN)
  - `visitDate` (DATE)
  - `notes` (TEXT)
- [ ] Создать таблицу `photos` для хранения связей фотографий с местами/поездками
- [ ] Реализовать функции миграции базы данных

### 1.3 Создание типов TypeScript
- [ ] Определить интерфейс `Place`
- [ ] Определить интерфейс `Trip`
- [ ] Определить интерфейс `TripPlace`
- [ ] Определить интерфейс `Photo`
- [ ] Создать типы для координат (DD - Decimal Degrees)

### 1.4 Настройка навигации
- [ ] Создать структуру маршрутов в `app/` директории
- [ ] Настроить главный экран с кнопками навигации
- [ ] Создать базовые экраны: Places, Trips, NextPlace, Settings

---

## Этап 2: Реализация режима "Места"

### 2.1 Создание сервиса для работы с местами
- [ ] Создать модуль `services/placesService.ts`
- [ ] Реализовать функцию `createPlace()` - создание нового места
- [ ] Реализовать функцию `getAllPlaces()` - получение всех мест
- [ ] Реализовать функцию `getPlaceById()` - получение места по ID
- [ ] Реализовать функцию `updatePlace()` - обновление места
- [ ] Реализовать функцию `deletePlace()` - удаление места
- [ ] Реализовать функцию `addPhotoToPlace()` - добавление фото к месту
- [ ] Реализовать функцию `removePhotoFromPlace()` - удаление фото

### 2.2 Экран списка мест
- [ ] Создать экран `app/places/index.tsx`
- [ ] Реализовать отображение списка мест в виде карточек
- [ ] Добавить кнопку "Добавить место" (FAB)
- [ ] Реализовать поиск/фильтрацию мест
- [ ] Добавить индикаторы для `visitlater` и `liked`
- [ ] Реализовать навигацию к детальной карточке места

### 2.3 Экран создания/редактирования места
- [ ] Создать экран `app/places/[id].tsx` или модальное окно
- [ ] Реализовать форму с полями:
  - Название места
  - Описание
  - Переключатель "Посетить позже"
  - Переключатель "Понравилось"
  - Выбор координат (через карту или ввод)
- [ ] Добавить возможность прикрепления фотографий
- [ ] Реализовать сохранение данных в базу
- [ ] Добавить валидацию формы

### 2.4 Экран детальной карточки места
- [ ] Создать экран `app/places/[id]/details.tsx`
- [ ] Отобразить всю информацию о месте
- [ ] Показать фотографии места
- [ ] Добавить кнопку "Открыть на карте"
- [ ] Добавить кнопку "Открыть в навигаторе"
- [ ] Реализовать редактирование места
- [ ] Реализовать удаление места

### 2.5 Интеграция с картами для мест
- [ ] Добавить компонент карты на экран детальной карточки
- [ ] Реализовать выбор координат через карту при создании места
- [ ] Добавить маркер места на карте
- [ ] Реализовать открытие места в системном навигаторе

---

## Этап 3: Реализация режима "Поездки"

### 3.1 Создание сервиса для работы с поездками
- [ ] Создать модуль `services/tripsService.ts`
- [ ] Реализовать функцию `createTrip()` - создание новой поездки
- [ ] Реализовать функцию `getAllTrips()` - получение всех поездок
- [ ] Реализовать функцию `getTripById()` - получение поездки по ID
- [ ] Реализовать функцию `updateTrip()` - обновление поездки
- [ ] Реализовать функцию `deleteTrip()` - удаление поездки
- [ ] Реализовать функцию `setCurrentTrip()` - установка текущей поездки
- [ ] Реализовать функцию `getCurrentTrip()` - получение текущей поездки

### 3.2 Создание сервиса для работы с местами в поездке
- [ ] Создать модуль `services/tripPlacesService.ts`
- [ ] Реализовать функцию `addPlaceToTrip()` - добавление места в поездку
- [ ] Реализовать функцию `removePlaceFromTrip()` - удаление места из поездки
- [ ] Реализовать функцию `updatePlaceOrder()` - изменение порядка мест
- [ ] Реализовать функцию `markPlaceAsVisited()` - отметка места как посещенного
- [ ] Реализовать функцию `addNotesToTripPlace()` - добавление заметок
- [ ] Реализовать функцию `addPhotoToTripPlace()` - добавление фото к посещению

### 3.3 Экран списка поездок
- [ ] Создать экран `app/trips/index.tsx`
- [ ] Реализовать отображение списка поездок
- [ ] Показать даты поездки, количество мест
- [ ] Выделить текущую поездку
- [ ] Добавить кнопку "Создать поездку" (FAB)
- [ ] Реализовать навигацию к деталям поездки

### 3.4 Экран создания/редактирования поездки
- [ ] Создать экран `app/trips/[id]/edit.tsx`
- [ ] Реализовать форму с полями:
  - Название поездки
  - Описание
  - Дата начала
  - Дата окончания
  - Переключатель "Текущая поездка"
- [ ] Реализовать сохранение поездки

### 3.5 Экран деталей поездки (маршрут)
- [ ] Создать экран `app/trips/[id]/details.tsx`
- [ ] Отобразить информацию о поездке
- [ ] Показать упорядоченный список мест в маршруте
- [ ] Реализовать drag-and-drop для изменения порядка мест
- [ ] Добавить возможность добавления мест из базы мест
- [ ] Добавить возможность создания нового места прямо в поездке
- [ ] Показать статус посещения каждого места (visited/not visited)
- [ ] Реализовать отметку места как посещенного
- [ ] Добавить возможность добавления заметок и фотографий к посещению

### 3.6 Экран просмотра места в поездке
- [ ] Создать экран или модальное окно для просмотра места в контексте поездки
- [ ] Показать информацию о месте
- [ ] Показать заметки и фотографии, сделанные во время посещения
- [ ] Добавить возможность редактирования заметок
- [ ] Добавить возможность добавления фотографий

---

## Этап 4: Реализация режима "Следующее место"

### 4.1 Создание сервиса для следующего места
- [x] Создать модуль `services/nextPlaceService.ts`
- [x] Реализовать функцию `getNextPlace()` - получение следующего места
- [x] Логика: найти текущую поездку, найти первое место с `visited = false`

### 4.2 Экран "Следующее место"
- [x] Создать экран `app/next-place/index.tsx`
- [x] Отобразить информацию о следующем месте
- [x] Показать фотографии места (если есть)
- [x] Показать описание места
- [x] Добавить кнопку "Открыть на карте"
- [x] Добавить кнопку "Открыть в навигаторе"
- [x] Добавить кнопку "Отметить как посещенное"
- [x] Обработать случай, когда следующего места нет

---

## Этап 5: Главный экран и навигация

### 5.1 Главный экран
- [x] Создать/обновить экран `app/index.tsx`
- [x] Добавить заголовок "GoNext"
- [x] Создать вертикальный ряд кнопок:
  - "Места"
  - "Поездки"
  - "Следующее место"
  - "Настройки"
- [x] Реализовать навигацию на соответствующие экраны
- [x] Добавить визуальное оформление с использованием React Native Paper

### 5.2 Настройка навигации
- [x] Настроить Stack Navigator для основных экранов
- [x] Настроить навигацию между экранами
- [x] Добавить кнопки "Назад" где необходимо
- [x] Реализовать правильную структуру маршрутов

---

## Этап 6: Интеграция с картами и навигацией

### 6.1 Интеграция с картами
- [x] Настроить `react-native-maps` или использовать Expo Location API
- [x] Реализовать отображение места на карте
- [x] Реализовать выбор координат через карту
- [x] Добавить маркеры для мест в поездке
- [ ] Реализовать отображение маршрута (опционально для MVP)

### 6.2 Интеграция с навигаторами
- [x] Реализовать открытие места в Google Maps (Android)
- [x] Реализовать открытие места в Apple Maps (iOS)
- [x] Использовать deep linking для открытия навигатора с координатами

---

## Этап 7: Работа с фотографиями

### 7.1 Сервис для работы с фотографиями
- [x] Создать модуль `services/photosService.ts`
- [x] Реализовать сохранение фотографий в файловую систему
- [x] Реализовать получение пути к фотографии
- [x] Реализовать удаление фотографий
- [x] Реализовать связь фотографий с местами и поездками в БД

### 7.2 Компоненты для работы с фотографиями
- [x] Создать компонент для выбора фотографии из галереи
- [x] Создать компонент для отображения фотографий
- [x] Создать компонент галереи фотографий
- [x] Реализовать возможность удаления фотографий

---

## Этап 8: Экран настроек

### 8.1 Базовый экран настроек
- [x] Создать экран `app/settings/index.tsx`
- [x] Добавить базовые настройки (если нужны для MVP)
- [x] Добавить информацию о приложении
- [x] Добавить возможность экспорта данных (для будущего развития)

---

## Этап 9: Тестирование и оптимизация

### 9.1 Тестирование функциональности
- [ ] Протестировать создание, редактирование, удаление мест
- [ ] Протестировать создание, редактирование, удаление поездок
- [ ] Протестировать добавление мест в поездку
- [ ] Протестировать изменение порядка мест
- [ ] Протестировать отметку мест как посещенных
- [ ] Протестировать работу с фотографиями
- [ ] Протестировать режим "Следующее место"
- [ ] Протестировать интеграцию с картами и навигаторами

### 9.2 Тестирование на разных устройствах
- [ ] Протестировать на Android устройстве
- [ ] Протестировать на iOS устройстве (если доступно)
- [ ] Проверить работу на разных размерах экранов
- [ ] Проверить работу в офлайн режиме

### 9.3 Оптимизация
- [ ] Оптимизировать запросы к базе данных
- [ ] Оптимизировать загрузку фотографий
- [ ] Проверить производительность при большом количестве данных
- [ ] Оптимизировать использование памяти

---

## Этап 10: Финализация и документация

### 10.1 Финальная проверка
- [ ] Проверить соответствие требованиям из PROJECT.md
- [ ] Убедиться, что все данные хранятся локально
- [ ] Убедиться, что приложение работает офлайн
- [ ] Проверить навигацию между всеми экранами
- [ ] Проверить работу всех функций

### 10.2 Документация
- [ ] Обновить README.md с инструкциями по запуску
- [ ] Добавить комментарии в код
- [ ] Документировать структуру базы данных
- [ ] Документировать API сервисов

---

## Приоритеты реализации

**MVP (Минимально жизнеспособный продукт):**
1. Этап 1 - Настройка проекта и инфраструктуры
2. Этап 2 - Режим "Места" (базовая функциональность)
3. Этап 3 - Режим "Поездки" (базовая функциональность)
4. Этап 4 - Режим "Следующее место"
5. Этап 5 - Главный экран и навигация
6. Этап 6 - Базовая интеграция с картами
7. Этап 9 - Базовое тестирование

**Дополнительно для полноценного MVP:**
- Этап 7 - Работа с фотографиями (базовая)
- Этап 8 - Экран настроек (минимальный)

**После MVP:**
- Расширенная работа с фотографиями
- Улучшенная интеграция с картами
- Оптимизация и улучшение UX
