# Тестирование приложения GoNext

## Автоматические тесты

Запуск unit-тестов сервисов:

```powershell
npm test
```

Покрытие:
- **nextPlaceService** — логика получения следующего места (нет поездки, первое непосещённое, все посещены).
- **placesService** — создание, получение, обновление, удаление мест, пакетное получение по id.
- **tripsService** — создание, получение поездок, текущая поездка, удаление (включая фото мест), установка текущей поездки.

---

## Чек-лист ручного тестирования (9.1)

### Места
- [ ] Создать новое место (название, описание, координаты, «посетить позже», «понравилось»).
- [ ] Открыть список мест, убедиться, что новое место отображается.
- [ ] Отредактировать место и сохранить — изменения отображаются.
- [ ] Удалить место — оно пропадает из списка.

### Поездки
- [ ] Создать новую поездку (название, даты, текущая/не текущая).
- [ ] Создать поездку и сделать её текущей.
- [ ] Отредактировать поездку и удалить поездку — список обновляется.

### Места в поездке
- [ ] Добавить места в поездку (из списка мест или создать новое).
- [ ] Изменить порядок мест (drag-and-drop).
- [ ] Отметить место как посещённое — статус и дата обновляются.
- [ ] Добавить заметки и фото к месту в поездке.

### Фотографии
- [ ] Добавить фото к месту и к месту в поездке.
- [ ] Просмотреть галерею, удалить фото.

### Режим «Следующее место»
- [ ] При наличии текущей поездки с непосещёнными местами — отображается первое такое место.
- [ ] Отметить следующее место как посещённое — экран обновляется, показывается следующее.
- [ ] При отсутствии текущей поездки или при всех посещённых местах — показывается заглушка.

### Карты и навигация
- [ ] Открыть место на карте — маркер и карта отображаются.
- [ ] Выбрать координаты на карте при создании/редактировании места.
- [ ] «Открыть в навигаторе» — открывается системное приложение (Google/Apple Maps) с точкой.

---

## Чек-лист по устройствам и средам (9.2)

- [ ] **Android** — установка, запуск, основные сценарии (места, поездки, следующее место, карты).
- [ ] **iOS** (если доступно) — то же.
- [ ] **Разные размеры экранов** — список, формы, карта и кнопки не обрезаются, скролл работает.
- [ ] **Офлайн** — отключить интернет и убедиться, что приложение работает (данные локальные, карты могут кэшироваться).

---

## Оптимизация (9.3) — выполнено

- Добавлен индекс `idx_trips_current` для запроса текущей поездки.
- При удалении поездки удаляются фото всех мест поездки (исправлена утечка записей и файлов).
- `getTripPlacesWithDetails` переведён на пакетные запросы (`getPlacesByIds`, `getPhotosForTripPlaceIds`) вместо N+1 запросов.
